# Release Notes Instructions

## Objective
Generate comprehensive, well-organized release notes from a release candidate, ready for publication to stakeholders.

## Prerequisites
- Release candidate exists and is validated
- Stories in release have descriptions and types
- Template file available

---

<step n="1" goal="Identify release candidate">

### Select Release

<action>Load release state from module-state.yaml</action>

<check if="multiple release candidates exist">
<ask>Which release would you like to generate notes for?
{{#each release_candidates}}
[{{index}}] {{version}} - {{status}} ({{story_count}} stories)
{{/each}}

Selection: </ask>
<action>Load selected release candidate</action>
</check>

<check if="single release candidate exists">
<action>Auto-select current release candidate</action>
</check>

<check if="no release candidates exist">
<action>Error: No release candidates found. Run *plan-release first.</action>
</check>

**Selected Release:** {{version}}
**Status:** {{status}}
**Stories:** {{story_count}}

</step>

---

<step n="2" goal="Load story details">

### Load Story Information

<action>Load full details for each story in release</action>
<action>Categorize stories by type</action>
<action>Extract key information for notes</action>

**Release Contents:**

| Category | Count |
|----------|-------|
| Features | {{features.length}} |
| Bug Fixes | {{bug_fixes.length}} |
| Improvements | {{improvements.length}} |
| Security | {{security.length}} |
| Breaking Changes | {{breaking_changes.length}} |

</step>

---

<step n="3" goal="Choose output format">

### Output Format

<ask>What format should the release notes be in?
[m] Markdown (GitHub/GitLab compatible)
[h] HTML (web publishing)
[s] Slack (for announcements)
[a] All formats

Format: </ask>

<action>Store as {{output_format}}</action>

</step>

---

<step n="4" goal="Customize release notes">

### Customize Content

<ask>Do you want to add any custom highlights or summary?
[y] Yes - add custom content
[n] No - use auto-generated summary

Choice: </ask>

<check if="choice == 'y'">
<ask>Enter release summary/highlights (1-3 sentences): </ask>
<action>Store as {{custom_summary}}</action>
</check>

<ask>Include contributor acknowledgments?
[y] Yes
[n] No

Choice: </ask>

<action>Store as {{include_contributors}}</action>

<ask>Include links to issues/PRs?
[y] Yes
[n] No

Choice: </ask>

<action>Store as {{include_links}}</action>

</step>

---

<step n="5" goal="Generate release notes">

### Generate Release Notes

<action>Load release notes template</action>
<action>Populate template with release data</action>

<template-output section="release-notes">
# Release {{version}}

**Release Date:** {{release_date}}
**Release Type:** {{release_type}}

{{#if custom_summary}}
## Highlights
{{custom_summary}}
{{/if}}

{{#if breaking_changes.length}}
## Breaking Changes
{{#each breaking_changes}}
- **{{title}}**: {{description}}
{{/each}}
{{/if}}

## What's New

### Features
{{#each features}}
- {{title}} {{#if include_links}}([#{{id}}]({{link}})){{/if}}
  {{description}}
{{/each}}

### Bug Fixes
{{#each bug_fixes}}
- {{title}} {{#if include_links}}([#{{id}}]({{link}})){{/if}}
{{/each}}

### Improvements
{{#each improvements}}
- {{title}} {{#if include_links}}([#{{id}}]({{link}})){{/if}}
{{/each}}

{{#if security.length}}
### Security Updates
{{#each security}}
- {{title}}
{{/each}}
{{/if}}

{{#if include_contributors}}
## Contributors
Thanks to everyone who contributed to this release:
{{#each contributors}}
- @{{username}}
{{/each}}
{{/if}}

---
*Generated by BMAD Release Manager*
</template-output>

</step>

---

<step n="6" goal="Generate additional formats" condition="output_format in ['h', 'a']">

### Generate HTML Format

<action>Convert markdown to HTML</action>
<action>Apply styling template</action>
<action>Save as {{version}}-release-notes.html</action>

</step>

---

<step n="7" goal="Generate Slack format" condition="output_format in ['s', 'a']">

### Generate Slack Announcement

<action>Create Slack-formatted message</action>

**Slack Message Preview:**
```
:rocket: *Release {{version}}* is now available!

*Highlights:*
{{custom_summary || auto_summary}}

*What's New:*
• {{features.length}} new features
• {{bug_fixes.length}} bug fixes
• {{improvements.length}} improvements

{{#if breaking_changes.length}}
:warning: This release includes breaking changes. See full notes.
{{/if}}

<{{release_notes_url}}|View Full Release Notes>
```

</step>

---

<step n="8" goal="Save and display">

### Save Release Notes

<action>Save markdown file to output folder</action>
<action>Update release candidate with notes path</action>
<action>Display preview</action>

**Files Generated:**
- Markdown: {{markdown_path}}
{{#if html_generated}}- HTML: {{html_path}}{{/if}}
{{#if slack_generated}}- Slack: {{slack_path}}{{/if}}

</step>

---

## Completion

Release notes generated for **{{version}}**.

**Summary:**
- Features: {{features.length}}
- Bug Fixes: {{bug_fixes.length}}
- Improvements: {{improvements.length}}
{{#if breaking_changes.length}}- Breaking Changes: {{breaking_changes.length}}{{/if}}

**Output:** {{output_file_path}}

**Next Steps:**
1. Review and edit release notes if needed
2. Publish to changelog/documentation
3. Share Slack announcement with team
4. Proceed with deployment: `*deploy`
